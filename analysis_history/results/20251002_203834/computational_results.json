{
  "plan": {
    "analysis_plan": "Compute per-image and per-structure consensus among models, compare confidence distributions with agreement, and flag images with low agreement or low confidence for further review.",
    "python_code": "import pandas as pd\nimport numpy as np\n\n# Expected input format: a DataFrame or CSV with columns:\n# image_id, model_id, anatomy_label, abnormality_label, image_quality (optional), confidence (0-1)\n# Example filename: predictions.csv (if present)\n\ntry:\n    df = pd.read_csv('predictions.csv')\nexcept Exception:\n    # If no CSV, assume 'df' already exists in the environment\n    if 'df' not in globals():\n        raise FileNotFoundError(\"predictions.csv not found and no 'df' variable provided.\")\n\n# Ensure types\ndf['image_id'] = df['image_id'].astype(str)\nif 'model_id' in df.columns:\n    df['model_id'] = df['model_id'].astype(str)\nelse:\n    df['model_id'] = df['model'].astype(str) if 'model' in df.columns else df.index.astype(str)\n\n# Utility to compute agreement for a given label column\ndef compute_agreement(df, label_col):\n    # group by image and compute majority label and agreement rate\n    def _image_stats(g):\n        total = len(g)\n        counts = g[label_col].value_counts(dropna=True)\n        if counts.empty:\n            majority_label = np.nan\n            agreement_rate = 0.0\n        else:\n            majority_label = counts.idxmax()\n            agreement_rate = counts.max() / total\n        mean_conf = g['confidence'].mean() if 'confidence' in g else np.nan\n        std_conf = g['confidence'].std(ddof=0) if 'confidence' in g else np.nan\n        return pd.Series({\n            'n_models': total,\n            'majority_label': majority_label,\n            'agreement_rate': agreement_rate,\n            'mean_confidence': mean_conf,\n            'std_confidence': std_conf\n        })\n\n    image_stats = df.groupby('image_id').apply(_image_stats).reset_index()\n\n    # Per-structure (label) summary: how often a label is majority and its average agreement\n    label_summary = (\n        image_stats.groupby('majority_label')\n        .agg(images_as_majority=('image_id', 'count'),\n             avg_agreement=('agreement_rate', 'mean'))\n        .sort_values('images_as_majority', ascending=False)\n        .reset_index()\n    )\n\n    # Pairwise model agreement matrix (proportion of identical labels between models)\n    models = df['model_id'].unique()\n    pairwise = pd.DataFrame(index=models, columns=models, dtype=float)\n\n    # Build pivot table: rows image_id, cols model_id, values = label\n    pivot = df.pivot_table(index='image_id', columns='model_id', values=label_col, aggfunc=lambda x: x.iloc[0])\n\n    for m1 in models:\n        for m2 in models:\n            # compute fraction of images where both models provided a label and labels match\n            col1 = pivot.get(m1)\n            col2 = pivot.get(m2)\n            valid = col1.notna() & col2.notna()\n            if valid.sum() == 0:\n                pairwise.loc[m1, m2] = np.nan\n            else:\n                pairwise.loc[m1, m2] = (col1[valid] == col2[valid]).mean()\n\n    return {\n        'image_stats': image_stats,\n        'label_summary': label_summary,\n        'pairwise_agreement': pairwise,\n        'pivot': pivot\n    }\n\n# Compute for anatomy_label and abnormality_label if present\nresults = {}\nif 'anatomy_label' in df.columns:\n    results['anatomy'] = compute_agreement(df, 'anatomy_label')\nif 'abnormality_label' in df.columns:\n    results['abnormality'] = compute_agreement(df, 'abnormality_label')\n\n# Additional analyses: correlation between mean_confidence and agreement_rate\nfor key in list(results.keys()):\n    image_stats = results[key]['image_stats']\n    # handle NaNs\n    corr = image_stats[['agreement_rate', 'mean_confidence']].dropna()\n    if not corr.empty:\n        results[key]['confidence_agreement_correlation'] = corr['agreement_rate'].corr(corr['mean_confidence'])\n    else:\n        results[key]['confidence_agreement_correlation'] = np.nan\n\n    # Flag images with low agreement or low confidence\n    LOW_AGREEMENT_THRESHOLD = 0.6\n    LOW_CONFIDENCE_THRESHOLD = 0.5\n    flags = image_stats[(image_stats['agreement_rate'] < LOW_AGREEMENT_THRESHOLD) |\n                        (image_stats['mean_confidence'] < LOW_CONFIDENCE_THRESHOLD)]\n    results[key]['flags'] = flags.sort_values(['agreement_rate', 'mean_confidence'])\n\n# Summary metrics per model: average confidence and average agreement with majority\nif 'anatomy' in results or 'abnormality' in results:\n    for label_type in results.keys():\n        pivot = results[label_type]['pivot']\n        # For each model, compute average confidence and agreement with image majority\n        model_stats = []\n        image_stats = results[label_type]['image_stats'].set_index('image_id')\n        for m in pivot.columns:\n            # average confidence from original df\n            conf = df[df['model_id'] == m]['confidence'].mean()\n            # agreement with majority: for images where model provided label, compare to majority_label\n            provided = pivot[m].dropna()\n            if provided.empty:\n                agreement_with_majority = np.nan\n            else:\n                maj = image_stats.loc[provided.index, 'majority_label']\n                agreement_with_majority = (provided == maj).mean()\n            model_stats.append({'model_id': m, 'mean_confidence': conf, 'agreement_with_majority': agreement_with_majority})\n        results[label_type]['model_stats'] = pd.DataFrame(model_stats).set_index('model_id')\n\n# Final results variable available for inspection\n# results (dict) contains keys like 'anatomy' and/or 'abnormality' each with:\n# - image_stats (per-image agreement info)\n# - label_summary (per-label counts/avg agreement)\n# - pairwise_agreement (model x model agreement matrix)\n# - pivot (image x model labels)\n# - confidence_agreement_correlation (scalar)\n# - flags (images with low agreement/confidence)\n# - model_stats (per-model mean confidence and agreement with majority)\n\n# Example: inspect anatomy image stats\n# print(results['anatomy']['image_stats'].head())\n\n# Keep 'results' as the final variable for downstream use\n",
    "expected_outputs": "A 'results' dictionary containing per-image agreement tables, per-label summaries, model pairwise agreement matrices, correlation between confidence and agreement, and flagged low-agreement/low-confidence images.",
    "recommended_visualizations": [
      "bar chart (agreement_rate per image or per label)",
      "heatmap (pairwise model agreement matrix)",
      "scatter plot (mean_confidence vs. agreement_rate)"
    ]
  },
  "execution": {
    "success": true,
    "results": "\n--- Analysis for: Movement Rating ---\n\nImage Statistics (first 5 rows):\n| image_id      | n_models   | majority_label   | agreement_rate   | mean_confidence   | std_confidence   |\n|:--------------|:-----------|:-----------------|:-----------------|:------------------|:-----------------|\n| image_001.jpg | 2          | 3                | 0.5              | 0.75              | 0.05             |\n| image_003.jpg | 1          | 2                | 1                | 0.58              | 0                |\n| image_004.jpg | 1          | 5                | 1                | 0.9               | 0                |\n| image_005.jpg | 1          | 3                | 1                | 0.68              | 0                |\n\nLabel Summary:\n| majority_label   | images_as_majority   | avg_agreement   |\n|:-----------------|:---------------------|:----------------|\n| 3                | 2                    | 0.75            |\n| 2                | 1                    | 1               |\n| 5                | 1                    | 1               |\n\nPairwise Model Agreement:\n|                   | Gemini 2.5 Vision   | Llama 3.2 Vision   | GPT-5 Vision   |\n|:------------------|:--------------------|:-------------------|:---------------|\n| Gemini 2.5 Vision | 1                   | 0                  | nan            |\n| Llama 3.2 Vision  | 0                   | 1                  | nan            |\n| GPT-5 Vision      | nan                 | nan                | 1              |\n\nConfidence-Agreement Correlation:\n-0.11151979703745832\n\nFlagged Images (Low Agreement or Low Confidence):\n| image_id      | n_models   | majority_label   | agreement_rate   | mean_confidence   | std_confidence   |\n|:--------------|:-----------|:-----------------|:-----------------|:------------------|:-----------------|\n| image_001.jpg | 2          | 3                | 0.5              | 0.75              | 0.05             |\n\nModel Statistics:\n| model_id          | mean_confidence   | agreement_with_majority   |\n|:------------------|:------------------|:--------------------------|\n| GPT-5 Vision      | 0.525             | 1                         |\n| Gemini 2.5 Vision | 0.80625           | 1                         |\n| Llama 3.2 Vision  | 0.8125            | 0.5                       |\n\n--- Analysis for: Visual Quality Rating ---\n\nImage Statistics (first 5 rows):\n| image_id       | n_models   | majority_label   | agreement_rate   | mean_confidence   | std_confidence   |\n|:---------------|:-----------|:-----------------|:-----------------|:------------------|:-----------------|\n| image_001.jpg  | 3          | 3                | 0.666667         | 0.673333          | 0.115854         |\n| image_002.webp | 3          | 2                | 0.333333         | 0.69              | 0.192007         |\n| image_003.jpg  | 3          | 4                | 1                | 0.726667          | 0.103709         |\n| image_003.webp | 3          | 3                | 0.666667         | 0.716667          | 0.192931         |\n| image_004.jpg  | 3          | 4                | 0.666667         | 0.783333          | 0.164992         |\n\nLabel Summary:\n| majority_label   | images_as_majority   | avg_agreement   |\n|:-----------------|:---------------------|:----------------|\n| 3                | 3                    | 0.666667        |\n| 4                | 3                    | 0.888889        |\n| 2                | 2                    | 0.333333        |\n\nPairwise Model Agreement:\n|                   | GPT-5 Vision   | Gemini 2.5 Vision   | Llama 3.2 Vision   |\n|:------------------|:---------------|:--------------------|:-------------------|\n| GPT-5 Vision      | 1              | 0.75                | 0.25               |\n| Gemini 2.5 Vision | 0.75           | 1                   | 0.25               |\n| Llama 3.2 Vision  | 0.25           | 0.25                | 1                  |\n\nConfidence-Agreement Correlation:\n0.6405683832557008\n\nFlagged Images (Low Agreement or Low Confidence):\n| image_id       | n_models   | majority_label   | agreement_rate   | mean_confidence   | std_confidence   |\n|:---------------|:-----------|:-----------------|:-----------------|:------------------|:-----------------|\n| image_004.webp | 3          | 2                | 0.333333         | 0.64              | 0.160831         |\n| image_002.webp | 3          | 2                | 0.333333         | 0.69              | 0.192007         |\n\nModel Statistics:\n| model_id          | mean_confidence   | agreement_with_majority   |\n|:------------------|:------------------|:--------------------------|\n| GPT-5 Vision      | 0.525             | 1                         |\n| Gemini 2.5 Vision | 0.80625           | 0.75                      |\n| Llama 3.2 Vision  | 0.8125            | 0.25                      |\n\n--- Analysis for: Artifact Presence Rating ---\n\nImage Statistics (first 5 rows):\n| image_id       | n_models   | majority_label   | agreement_rate   | mean_confidence   | std_confidence   |\n|:---------------|:-----------|:-----------------|:-----------------|:------------------|:-----------------|\n| image_001.jpg  | 3          | 2                | 0.666667         | 0.673333          | 0.115854         |\n| image_002.webp | 2          | 2                | 1                | 0.825             | 0.025            |\n| image_003.jpg  | 3          | 2                | 0.666667         | 0.726667          | 0.103709         |\n| image_003.webp | 3          | 2                | 1                | 0.716667          | 0.192931         |\n| image_004.jpg  | 3          | 2                | 0.666667         | 0.783333          | 0.164992         |\n\nLabel Summary:\n| majority_label   | images_as_majority   | avg_agreement   |\n|:-----------------|:---------------------|:----------------|\n| 2                | 7                    | 0.857143        |\n| 3                | 1                    | 0.666667        |\n\nPairwise Model Agreement:\n|                   | GPT-5 Vision   | Gemini 2.5 Vision   | Llama 3.2 Vision   |\n|:------------------|:---------------|:--------------------|:-------------------|\n| GPT-5 Vision      | 1              | 0.714286            | 0.571429           |\n| Gemini 2.5 Vision | 0.714286       | 1                   | 0.625              |\n| Llama 3.2 Vision  | 0.571429       | 0.625               | 1                  |\n\nConfidence-Agreement Correlation:\n0.4652986266943055\n\nFlagged Images (Low Agreement or Low Confidence):\nNone\n\nModel Statistics:\n| model_id          | mean_confidence   | agreement_with_majority   |\n|:------------------|:------------------|:--------------------------|\n| GPT-5 Vision      | 0.525             | 0.857143                  |\n| Gemini 2.5 Vision | 0.80625           | 0.875                     |\n| Llama 3.2 Vision  | 0.8125            | 0.75                      |\n",
    "generated_code": "import pandas as pd\nimport numpy as np\nimport json\n\ndata = [\n  {\n    \"image_path\": \"analysis_history\\\\images\\\\20251002_190619\\\\image_001.jpg\",\n    \"image_name\": \"image_001.jpg\",\n    \"model_results\": {\n      \"GPT-5 Vision\": {\n        \"model_name\": \"GPT-5 Vision (gpt-5-nano)\",\n        \"movement_rating\": None,\n        \"visual_quality_rating\": 3.0,\n        \"artifact_presence_rating\": 2.0,\n        \"detected_artifacts\": [\n          \"motion blur\",\n          \"low signal-to-noise ratio\",\n          \"susceptibility artifact near posterior structures\"\n        ],\n        \"confidence\": 0.52,\n        \"rationale\": \"Single sagittal knee MRI image. Moderate image quality with mild motion-related blur and low SNR, limiting evaluation of articular cartilage and menisci. No definite acute fracture or gross malalignment evident on this single slice. Visible anatomy includes femoral condyle, tibial plateau, and menisci; however, without additional sequences/planes, cannot confidently identify meniscal tears or subtle cartilage/bone marrow abnormalities. Findings are non-specific; if clinical concern persists, correlate with other sequences and clinical exam.\",\n        \"raw_response\": \"{\\n  \\\"movement_rating\\\": null,\\n  \\\"visual_quality_rating\\\": 3,\\n  \\\"artifact_presence_rating\\\": 2,\\n  \\\"detected_artifacts\\\": [\\\"motion blur\\\", \\\"low signal-to-noise ratio\\\", \\\"susceptibility artifact near posterior structures\\\"],\\n  \\\"confidence\\\": 0.52,\\n  \\\"rationale\\\": \\\"Single sagittal knee MRI image. Moderate image quality with mild motion-related blur and low SNR, limiting evaluation of articular cartilage and menisci. No definite acute fracture or gross malalignment evident on this single slice. Visible anatomy includes femoral condyle, tibial plateau, and menisci; however, without additional sequences/planes, cannot confidently identify meniscal tears or subtle cartilage/bone marrow abnormalities. Findings are non-specific; if clinical concern persists, correlate with other sequences and clinical exam.\\\"\\n}\"\n      },\n      \"Gemini 2.5 Vision\": {\n        \"model_name\": \"Gemini 2.5 Vision (gemini-2.5-flash-lite)\",\n        \"movement_rating\": 3.0,\n        \"visual_quality_rating\": 3.0,\n        \"artifact_presence_rating\": 3.0,\n        \"detected_artifacts\": [\n          \"susceptibility artifact\"\n        ],\n        \"confidence\": 0.7,\n        \"rationale\": \"The image quality is moderate, with some blurring and signal loss suggestive of minor patient motion and susceptibility artifacts, particularly in the anterior aspect of the knee. Anatomical structures like the femur, tibia, and patella are generally identifiable, but their fine details and signal homogeneity are affected by these limitations. Abnormalities are difficult to definitively assess due to the image quality, but there appear to be some degenerative changes in the cartilage. A definite diagnosis cannot be made without higher quality images.\",\n        \"raw_response\": \"```json\\n{\\n  \\\"movement_rating\\\": 3,\\n  \\\"visual_quality_rating\\\": 3,\\n  \\\"artifact_presence_rating\\\": 3,\\n  \\\"detected_artifacts\\\": [\\n    \\\"susceptibility artifact\\\"\\n  ],\\n  \\\"confidence\\\": 0.7,\\n  \\\"rationale\\\": \\\"The image quality is moderate, with some blurring and signal loss suggestive of minor patient motion and susceptibility artifacts, particularly in the anterior aspect of the knee. Anatomical structures like the femur, tibia, and patella are generally identifiable, but their fine details and signal homogeneity are affected by these limitations. Abnormalities are difficult to definitively assess due to the image quality, but there appear to be some degenerative changes in the cartilage. A definite diagnosis cannot be made without higher quality images.\\\"\\n}\\n```\"\n      },\n      \"Llama 3.2 Vision\": {\n        \"model_name\": \"Llama 3.2 Vision (meta-llama/llama-3.2-90b-vision-instruct)\",\n        \"movement_rating\": 5.0,\n        \"visual_quality_rating\": 4.0,\n        \"artifact_presence_rating\": 2.0,\n        \"detected_artifacts\": [\n          \"minor motion artifact\"\n        ],\n        \"confidence\": 0.8,\n        \"rationale\": \"The MRI image shows a clear view of the knee joint with minimal signs of movement or distortion. The visual quality is good, allowing for the identification of anatomical structures. There is a slight indication of minor motion artifact, but it does not significantly impact the overall assessment.\",\n        \"raw_response\": \"{\\n  \\\"movement_rating\\\": 5,\\n  \\\"visual_quality_rating\\\": 4,\\n  \\\"artifact_presence_rating\\\": 2,\\n  \\\"detected_artifacts\\\": [\\\"minor motion artifact\\\"],\\n  \\\"confidence\\\": 0.8,\\n  \\\"rationale\\\": \\\"The MRI image shows a clear view of the knee joint with minimal signs of movement or distortion. The visual quality is good, allowing for the identification of anatomical structures. There is a slight indication of minor motion artifact, but it does not significantly impact the overall assessment.\\\"\\n}\"\n      }\n    }\n  },\n  {\n    \"image_path\": \"analysis_history\\\\images\\\\20251002_190619\\\\image_003.jpg\",\n    \"image_name\": \"image_003.jpg\",\n    \"model_results\": {\n      \"GPT-5 Vision\": {\n        \"model_name\": \"GPT-5 Vision (gpt-5-nano)\",\n        \"movement_rating\": 2.0,\n        \"visual_quality_rating\": 4.0,\n        \"artifact_presence_rating\": 3.0,\n        \"detected_artifacts\": [\n          \"metallic/anchor-like artifact near glenoid-humeral joint in image b\",\n          \"susceptibility artifact around intra-articular hardware\",\n          \"potential mild motion blur in some frames (d/e/f)\"\n        ],\n        \"confidence\": 0.58,\n        \"rationale\": \"The series shows shoulder anatomy with intact alignment and no obvious dislocation. Image b contains a metallic implant with associated artifact. Overall image quality is good, though hardware-related artifacts are present and may obscure adjacent structures. A small amount of motion blur in some frames is possible. The dataset does not provide definitive evidence of acute pathology; subtle rotator cuff or labral injuries cannot be ruled out without further sequences or clinical correlation.\",\n        \"raw_response\": \"{\\n  \\\"movement_rating\\\": 2,\\n  \\\"visual_quality_rating\\\": 4,\\n  \\\"artifact_presence_rating\\\": 3,\\n  \\\"detected_artifacts\\\": [\\n    \\\"metallic/anchor-like artifact near glenoid-humeral joint in image b\\\",\\n    \\\"susceptibility artifact around intra-articular hardware\\\",\\n    \\\"potential mild motion blur in some frames (d/e/f)\\\"\\n  ],\\n  \\\"confidence\\\": 0.58,\\n  \\\"rationale\\\": \\\"The series shows shoulder anatomy with intact alignment and no obvious dislocation. Image b contains a metallic implant with associated artifact. Overall image quality is good, though hardware-related artifacts are present and may obscure adjacent structures. A small amount of motion blur in some frames is possible. The dataset does not provide definitive evidence of acute pathology; subtle rotator cuff or labral injuries cannot be ruled out without further sequences or clinical correlation.\\\"\\n}\"\n      },\n      \"Gemini 2.5 Vision\": {\n        \"model_name\": \"Gemini 2.5 Vision (gemini-2.5-flash-lite)\",\n        \"movement_rating\": None,\n        \"visual_quality_rating\": 4.0,\n        \"artifact_presence_rating\": 2.0,\n        \"detected_artifacts\": [\n          \"susceptibility artifact\"\n        ],\n        \"confidence\": 0.8,\n        \"rationale\": \"The images are of good quality, allowing for reasonable visualization of the shoulder joint structures. Image 'b' displays a notable susceptibility artifact, likely due to a metallic implant or calcification, which obscures detailed assessment of the immediate surrounding tissues. Other images show good detail of the glenohumeral joint, rotator cuff tendons, and surrounding bone. The anterior and posterior labrum, as well as the biceps tendon, appear to be visualized well in most slices, though the artifact in 'b' limits assessment in that region. Given the presence of a significant artifact in one of the slices, the artifact presence rating is moderate. Overall confidence is high due to clear visualization in most images, but the artifact in 'b' prevents a perfect score.\",\n        \"raw_response\": \"```json\\n{\\n  \\\"movement_rating\\\": null,\\n  \\\"visual_quality_rating\\\": 4,\\n  \\\"artifact_presence_rating\\\": 2,\\n  \\\"detected_artifacts\\\": [\\n    \\\"susceptibility artifact\\\"\\n  ],\\n  \\\"confidence\\\": 0.8,\\n  \\\"rationale\\\": \\\"The images are of good quality, allowing for reasonable visualization of the shoulder joint structures. Image 'b' displays a notable susceptibility artifact, likely due to a metallic implant or calcification, which obscures detailed assessment of the immediate surrounding tissues. Other images show good detail of the glenohumeral joint, rotator cuff tendons, and surrounding bone. The anterior and posterior labrum, as well as the biceps tendon, appear to be visualized well in most slices, though the artifact in 'b' limits assessment in that region. Given the presence of a significant artifact in one of the slices, the artifact presence rating is moderate. Overall confidence is high due to clear visualization in most images, but the artifact in 'b' prevents a perfect score.\\\"\\n}\\n```\"\n      },\n      \"Llama 3.2 Vision\": {\n        \"model_name\": \"Llama 3.2 Vision (meta-llama/llama-3.2-90b-vision-instruct)\",\n        \"movement_rating\": None,\n        \"visual_quality_rating\": 4.0,\n        \"artifact_presence_rating\": 2.0,\n        \"detected_artifacts\": [\n          \"Motion artifact not evident; minor signal inhomogeneity\"\n        ],\n        \"confidence\": 0.8,\n        \"rationale\": \"The MRI images provided are of a shoulder, likely showing various sequences of a shoulder joint. The visual quality is generally good with clear delineation of the anatomical structures. There are no obvious motion artifacts, but there might be some minor signal inhomogeneity. The images are likely T2-weighted given the contrast observed, which is typical for assessing soft tissue abnormalities.\",\n        \"raw_response\": \"{\\n  \\\"movement_rating\\\": null,\\n  \\\"visual_quality_rating\\\": 4,\\n  \\\"artifact_presence_rating\\\": 2,\\n  \\\"detected_artifacts\\\": [\\\"Motion artifact not evident; minor signal inhomogeneity\\\"],\\n  \\\"confidence\\\": 0.8,\\n  \\\"rationale\\\": \\\"The MRI images provided are of a shoulder, likely showing various sequences of a shoulder joint. The visual quality is generally good with clear delineation of the anatomical structures. There are no obvious motion artifacts, but there might be some minor signal inhomogeneity. The images are likely T2-weighted given the contrast observed, which is typical for assessing soft tissue abnormalities.\\\"\\n}\"\n      }\n    }\n  },\n  {\n    \"image_path\": \"analysis_history\\\\images\\\\20251002_190619\\\\image_004.jpg\",\n    \"image_name\": \"image_004.jpg\",\n    \"model_results\": {\n      \"GPT-5 Vision\": {\n        \"model_name\": \"GPT-5 Vision (gpt-5-nano)\",\n        \"movement_rating\": None,\n        \"visual_quality_rating\": 4.0,\n        \"artifact_presence_rating\": 2.0,\n        \"detected_artifacts\": [\n          \"annotation overlays (labels pointing to anatomy)\",\n          \"green highlight circle indicating region of interest\",\n          \"white pointer/label lines across image\"\n        ],\n        \"confidence\": 0.55,\n        \"rationale\": \"This is a lateral chest radiograph with labeled anatomic regions. Visual quality is good (clear visualization of posterior ribs, diaphragms, and retrosternal space). There are no obvious acute findings such as large pleural effusion, pneumothorax, or focal consolidation on this single view. The green-highlighted region and annotation overlays are non-diagnostic and may obscure subtle details, reducing objective interpretability. The assessment is limited without clinical context or additional views.\",\n        \"raw_response\": \"{\\n  \\\"movement_rating\\\": null,\\n  \\\"visual_quality_rating\\\": 4,\\n  \\\"artifact_presence_rating\\\": 2,\\n  \\\"detected_artifacts\\\": [\\n    \\\"annotation overlays (labels pointing to anatomy)\\\",\\n    \\\"green highlight circle indicating region of interest\\\",\\n    \\\"white pointer/label lines across image\\\"\\n  ],\\n  \\\"confidence\\\": 0.55,\\n  \\\"rationale\\\": \\\"This is a lateral chest radiograph with labeled anatomic regions. Visual quality is good (clear visualization of posterior ribs, diaphragms, and retrosternal space). There are no obvious acute findings such as large pleural effusion, pneumothorax, or focal consolidation on this single view. The green-highlighted region and annotation overlays are non-diagnostic and may obscure subtle details, reducing objective interpretability. The assessment is limited without clinical context or additional views.\\\"\\n}\"\n      },\n      \"Gemini 2.5 Vision\": {\n        \"model_name\": \"Gemini 2.5 Vision (gemini-2.5-flash-lite)\",\n        \"movement_rating\": None,\n        \"visual_quality_rating\": 4.0,\n        \"artifact_presence_rating\": 2.0,\n        \"detected_artifacts\": [\n          \"overlay text\"\n        ],\n        \"confidence\": 0.9,\n        \"rationale\": \"The image quality is good, with clear visualization of the anatomical structures. The retro-sternal clear space is well-defined. The lobes of the lung are outlined, and the posterior costophrenic angle is visible. There are no apparent abnormalities or anomalies in the visualized structures. The primary artifact is the overlay text which obstructs a small portion of the image but does not significantly hinder interpretation. Movement artifacts are not present.\",\n        \"raw_response\": \"```json\\n{\\n  \\\"movement_rating\\\": null,\\n  \\\"visual_quality_rating\\\": 4,\\n  \\\"artifact_presence_rating\\\": 2,\\n  \\\"detected_artifacts\\\": [\\n    \\\"overlay text\\\"\\n  ],\\n  \\\"confidence\\\": 0.9,\\n  \\\"rationale\\\": \\\"The image quality is good, with clear visualization of the anatomical structures. The retro-sternal clear space is well-defined. The lobes of the lung are outlined, and the posterior costophrenic angle is visible. There are no apparent abnormalities or anomalies in the visualized structures. The primary artifact is the overlay text which obstructs a small portion of the image but does not significantly hinder interpretation. Movement artifacts are not present.\\\"\\n}\\n```\"\n      },\n      \"Llama 3.2 Vision\": {\n        \"model_name\": \"Llama 3.2 Vision (meta-llama/llama-3.2-90b-vision-instruct)\",\n        \"movement_rating\": 5.0,\n        \"visual_quality_rating\": 5.0,\n        \"artifact_presence_rating\": 1.0,\n        \"detected_artifacts\": [],\n        \"confidence\": 0.9,\n        \"rationale\": \"The image is a clear and well-defined lateral chest X-ray with labeled anatomical structures. The high visual quality and absence of significant artifacts suggest a properly taken X-ray. The confidence is high due to the clarity and labeling of the image.\",\n        \"raw_response\": \"{\\\"movement_rating\\\": 5, \\\"visual_quality_rating\\\": 5, \\\"artifact_presence_rating\\\": 1, \\\"detected_artifacts\\\": [], \\\"confidence\\\": 0.9, \\\"rationale\\\": \\\"The image is a clear and well-defined lateral chest X-ray with labeled anatomical structures. The high visual quality and absence of significant artifacts suggest a properly taken X-ray. The confidence is high due to the clarity and labeling of the image.\\\"}\"\n      }\n    }\n  },\n  {\n    \"image_path\": \"analysis_history\\\\images\\\\20251002_190619\\\\image_005.jpg\",\n    \"image_name\": \"image_005.jpg\",\n    \"model_results\": {\n      \"GPT-5 Vision\": {\n        \"model_name\": \"GPT-5 Vision (gpt-5-nano)\",\n        \"movement_rating\": 3.0,\n        \"visual_quality_rating\": 4.0,\n        \"artifact_presence_rating\": 2.0,\n        \"detected_artifacts\": [\n          \"mild motion blur in some MRI slices\",\n          \"intraoperative images present (C, D) which are not standard MRI sequences\"\n        ],\n        \"confidence\": 0.68,\n        \"rationale\": \"Anatomical structures identifiable include the distal femur (femoral condyles), proximal tibia (tibial plateau), and likely meniscal/cartilaginous structures. Panel D shows a focal lesion on the articular surface with an osteochondral defect indicated by a star; corresponding subchondral irregularity is suggested on adjacent MRI slices (A, E, F). The bottom G image with contour/colour mapping highlights surface irregularities consistent with cartilage contour changes. There is no clear evidence of acute fracture or gross ligament rupture. Mild degenerative changes with possible small effusion are suspected. Some images are intraoperative (C, D), which limits their direct comparability to standard MRI sequences. Overall image quality is adequate for assessment. Clinical correlation and, if needed, dedicated MRI sequences or CT for planning may be warranted.\",\n        \"raw_response\": \"{\\n  \\\"movement_rating\\\": 3,\\n  \\\"visual_quality_rating\\\": 4,\\n  \\\"artifact_presence_rating\\\": 2,\\n  \\\"detected_artifacts\\\": [\\\"mild motion blur in some MRI slices\\\", \\\"intraoperative images present (C, D) which are not standard MRI sequences\\\"],\\n  \\\"confidence\\\": 0.68,\\n  \\\"rationale\\\": \\\"Anatomical structures identifiable include the distal femur (femoral condyles), proximal tibia (tibial plateau), and likely meniscal/cartilaginous structures. Panel D shows a focal lesion on the articular surface with an osteochondral defect indicated by a star; corresponding subchondral irregularity is suggested on adjacent MRI slices (A, E, F). The bottom G image with contour/colour mapping highlights surface irregularities consistent with cartilage contour changes. There is no clear evidence of acute fracture or gross ligament rupture. Mild degenerative changes with possible small effusion are suspected. Some images are intraoperative (C, D), which limits their direct comparability to standard MRI sequences. Overall image quality is adequate for assessment. Clinical correlation and, if needed, dedicated MRI sequences or CT for planning may be warranted.\\\"}\"\n      },\n      \"Gemini 2.5 Vision\": {\n        \"model_name\": \"Gemini 2.5 Vision (gemini-2.5-flash-lite)\",\n        \"movement_rating\": None,\n        \"visual_quality_rating\": 4.0,\n        \"artifact_presence_rating\": 2.0,\n        \"detected_artifacts\": [\n          \"suspected metal artifact in image F\"\n        ],\n        \"confidence\": 0.8,\n        \"rationale\": \"The images display various aspects of the knee joint, including MRI scans (A, B, E, F, G) and surgical views (C, D). Anatomical structures like the femur, tibia, patella, and cruciate ligaments appear discernible in the MRI sequences. Image F exhibits a possible artifact, potentially related to metal, indicated by a localized signal abnormality. Image G presents a quantitative assessment of cartilage, likely T1 mapping, with a color overlay. The overall image quality is good, allowing for reasonable assessment of the knee structures. Movement artifact is not apparent.\",\n        \"raw_response\": \"```json\\n{\\n  \\\"movement_rating\\\": null,\\n  \\\"visual_quality_rating\\\": 4,\\n  \\\"artifact_presence_rating\\\": 2,\\n  \\\"detected_artifacts\\\": [\\n    \\\"suspected metal artifact in image F\\\"\\n  ],\\n  \\\"confidence\\\": 0.8,\\n  \\\"rationale\\\": \\\"The images display various aspects of the knee joint, including MRI scans (A, B, E, F, G) and surgical views (C, D). Anatomical structures like the femur, tibia, patella, and cruciate ligaments appear discernible in the MRI sequences. Image F exhibits a possible artifact, potentially related to metal, indicated by a localized signal abnormality. Image G presents a quantitative assessment of cartilage, likely T1 mapping, with a color overlay. The overall image quality is good, allowing for reasonable assessment of the knee structures. Movement artifact is not apparent.\\\"\\n}\\n```\"\n      },\n      \"Llama 3.2 Vision\": {\n        \"model_name\": \"Llama 3.2 Vision (meta-llama/llama-3.2-90b-vision-instruct)\",\n        \"movement_rating\": None,\n        \"visual_quality_rating\": 4.0,\n        \"artifact_presence_rating\": 2.0,\n        \"detected_artifacts\": [\n          \"motion artifact not visible\",\n          \"some minor artifact presence\"\n        ],\n        \"confidence\": 0.8,\n        \"rationale\": \"The MRI images provided show clear visualization of the knee joint with some minor artifacts. The visual quality is generally good, allowing for the identification of anatomical structures and abnormalities. The presence of minor artifacts suggests some potential issues with image acquisition or processing, but they do not significantly impact the overall diagnostic quality.\",\n        \"raw_response\": \"{\\n  \\\"movement_rating\\\": null,\\n  \\\"visual_quality_rating\\\": 4,\\n  \\\"artifact_presence_rating\\\": 2,\\n  \\\"detected_artifacts\\\": [\\\"motion artifact not visible\\\", \\\"some minor artifact presence\\\"],\\n  \\\"confidence\\\": 0.8,\\n  \\\"rationale\\\": \\\"The MRI images provided show clear visualization of the knee joint with some minor artifacts. The visual quality is generally good, allowing for the identification of anatomical structures and abnormalities. The presence of minor artifacts suggests some potential issues with image acquisition or processing, but they do not significantly impact the overall diagnostic quality.\\\"}\"\n      }\n    }\n  },\n  {\n    \"image_path\": \"analysis_history\\\\images\\\\20251002_190619\\\\image_006.jpg\",\n    \"image_name\": \"image_006.jpg\",\n    \"model_results\": {\n      \"GPT-5 Vision\": {\n        \"model_name\": \"GPT-5 Vision (gpt-5-nano)\",\n        \"movement_rating\": None,\n        \"visual_quality_rating\": 3.0,\n        \"artifact_presence_rating\": 2.0,\n        \"detected_artifacts\": [\n          \"motion artifact\",\n          \"image blur\",\n          \"noise\"\n        ],\n        \"confidence\": 0.58,\n        \"rationale\": \"Anatomical structures visible: fibular collateral ligament (lateral collateral ligament) and biceps femoris tendon. No clear evidence of full-thickness tear or gross ligament disruption on this single sagittal-like sequence. No obvious meniscal tear or large joint effusion identified; evaluation limited by moderate image resolution and mild motion-related artifacts. Image quality is fair to good. Artifacts include mild motion blur and graininess, which may obscure subtle findings. For a more definitive assessment, correlate clinically and obtain additional knee sequences (e.g., PD or fat-saturated T2 in multiple planes) with improved resolution.\",\n        \"raw_response\": \"{\\n  \\\"movement_rating\\\": null,\\n  \\\"visual_quality_rating\\\": 3,\\n  \\\"artifact_presence_rating\\\": 2,\\n  \\\"detected_artifacts\\\": [\\\"motion artifact\\\", \\\"image blur\\\", \\\"noise\\\"],\\n  \\\"confidence\\\": 0.58,\\n  \\\"rationale\\\": \\\"Anatomical structures visible: fibular collateral ligament (lateral collateral ligament) and biceps femoris tendon. No clear evidence of full-thickness tear or gross ligament disruption on this single sagittal-like sequence. No obvious meniscal tear or large joint effusion identified; evaluation limited by moderate image resolution and mild motion-related artifacts. Image quality is fair to good. Artifacts include mild motion blur and graininess, which may obscure subtle findings. For a more definitive assessment, correlate clinically and obtain additional knee sequences (e.g., PD or fat-saturated T2 in multiple planes) with improved resolution.\\\"\\n}\"\n      },\n      \"Gemini 2.5 Vision\": {\n        \"model_name\": \"Gemini 2.5 Vision (gemini-2.5-flash-lite)\",\n        \"movement_rating\": None,\n        \"visual_quality_rating\": 3.0,\n        \"artifact_presence_rating\": 2.0,\n        \"detected_artifacts\": [\n          \"Gibbs ringing\"\n        ],\n        \"confidence\": 0.8,\n        \"rationale\": \"The image quality is moderate, with some noise and Gibbs ringing artifact present. Anatomical structures such as the fibular collateral ligament and biceps femoris tendon are visible and labeled, however, their integrity cannot be definitively assessed without higher quality images and more views. There are no obvious severe abnormalities, but the image quality limits the confidence in a complete assessment.\",\n        \"raw_response\": \"```json\\n{\\n  \\\"movement_rating\\\": null,\\n  \\\"visual_quality_rating\\\": 3,\\n  \\\"artifact_presence_rating\\\": 2,\\n  \\\"detected_artifacts\\\": [\\n    \\\"Gibbs ringing\\\"\\n  ],\\n  \\\"confidence\\\": 0.8,\\n  \\\"rationale\\\": \\\"The image quality is moderate, with some noise and Gibbs ringing artifact present. Anatomical structures such as the fibular collateral ligament and biceps femoris tendon are visible and labeled, however, their integrity cannot be definitively assessed without higher quality images and more views. There are no obvious severe abnormalities, but the image quality limits the confidence in a complete assessment.\\\"\\n}\\n```\"\n      },\n      \"Llama 3.2 Vision\": {\n        \"model_name\": \"Llama 3.2 Vision (meta-llama/llama-3.2-90b-vision-instruct)\",\n        \"movement_rating\": None,\n        \"visual_quality_rating\": 4.0,\n        \"artifact_presence_rating\": 2.0,\n        \"detected_artifacts\": [\n          \"minor motion artifact\"\n        ],\n        \"confidence\": 0.8,\n        \"rationale\": \"The image appears to be a high-quality MRI scan with clear visualization of anatomical structures such as the fibular collateral ligament and biceps femoris tendon. However, there are minor artifacts present, likely due to slight motion during the scan. The overall visual quality is good, but not perfect.\",\n        \"raw_response\": \"{\\\"movement_rating\\\": null, \\\"visual_quality_rating\\\": 4, \\\"artifact_presence_rating\\\": 2, \\\"detected_artifacts\\\": [\\\"minor motion artifact\\\"], \\\"confidence\\\": 0.8,\\n  \\\"rationale\\\": \\\"The image appears to be a high-quality MRI scan with clear visualization of the anatomical structures such as the fibular collateral ligament and biceps femoris tendon. However, there are minor artifacts present, likely due to slight motion during the scan. The overall visual quality is good, but not perfect.\\\"}\"\n      }\n    }\n  },\n  {\n    \"image_path\": \"analysis_history\\\\images\\\\20251002_190619\\\\image_002.webp\",\n    \"image_name\": \"image_002.webp\",\n    \"model_results\": {\n      \"GPT-5 Vision\": {\n        \"model_name\": \"GPT-5 Vision (gpt-5-nano)\",\n        \"movement_rating\": None,\n        \"visual_quality_rating\": 2.0,\n        \"artifact_presence_rating\": None,\n        \"detected_artifacts\": [],\n        \"confidence\": 0.42,\n        \"rationale\": \"The image is a low-resolution slide showing a small sagittal knee MRI frame. Visible anatomical cues are limited to general knee structures (likely femoral condyle and tibial plateau) with insufficient detail to assess menisci, ligaments, or cartilage. No definitive abnormalities can be identified due to poor image quality and limited field of view. Unable to reliably evaluate for pathology or artifacts from this image alone.\",\n        \"raw_response\": \"{\\n  \\\"movement_rating\\\": null,\\n  \\\"visual_quality_rating\\\": 2,\\n  \\\"artifact_presence_rating\\\": null,\\n  \\\"detected_artifacts\\\": [],\\n  \\\"confidence\\\": 0.42,\\n  \\\"rationale\\\": \\\"The image is a low-resolution slide showing a small sagittal knee MRI frame. Visible anatomical cues are limited to general knee structures (likely femoral condyle and tibial plateau) with insufficient detail to assess menisci, ligaments, or cartilage. No definitive abnormalities can be identified due to poor image quality and limited field of view. Unable to reliably evaluate for pathology or artifacts from this image alone.\\\"\\n}\"\n      },\n      \"Gemini 2.5 Vision\": {\n        \"model_name\": \"Gemini 2.5 Vision (gemini-2.5-flash-lite)\",\n        \"movement_rating\": None,\n        \"visual_quality_rating\": 3.0,\n        \"artifact_presence_rating\": 2.0,\n        \"detected_artifacts\": [\n          \"Gibbs ringing\"\n        ],\n        \"confidence\": 0.85,\n        \"rationale\": \"The image displays an MRI of a knee joint. Anatomical structures such as the femur, tibia, and patella are identifiable. There are no obvious gross abnormalities or anomalies visible in this sagittal view. The image quality is moderate, with some Gibbs ringing artifact present, particularly visible as step-like artifacts along areas of high signal intensity. This artifact slightly degrades the clarity of fine details but does not obscure the major anatomical structures or preclude a basic assessment. Movement artifacts are not apparent.\",\n        \"raw_response\": \"{\\\"movement_rating\\\": null, \\\"visual_quality_rating\\\": 3, \\\"artifact_presence_rating\\\": 2, \\\"detected_artifacts\\\": [\\\"Gibbs ringing\\\"], \\\"confidence\\\": 0.85, \\\"rationale\\\": \\\"The image displays an MRI of a knee joint. Anatomical structures such as the femur, tibia, and patella are identifiable. There are no obvious gross abnormalities or anomalies visible in this sagittal view. The image quality is moderate, with some Gibbs ringing artifact present, particularly visible as step-like artifacts along areas of high signal intensity. This artifact slightly degrades the clarity of fine details but does not obscure the major anatomical structures or preclude a basic assessment. Movement artifacts are not apparent.\\\"}\"\n      },\n      \"Llama 3.2 Vision\": {\n        \"model_name\": \"Llama 3.2 Vision (meta-llama/llama-3.2-90b-vision-instruct)\",\n        \"movement_rating\": None,\n        \"visual_quality_rating\": 4.0,\n        \"artifact_presence_rating\": 2.0,\n        \"detected_artifacts\": [\n          \"image truncation\"\n        ],\n        \"confidence\": 0.8,\n        \"rationale\": \"The MRI image of the knee joint appears to be of good visual quality, with clear delineation of the anatomical structures. However, there is a minor artifact due to image truncation at the top edge. The overall quality is not significantly compromised.\",\n        \"raw_response\": \"{\\\"movement_rating\\\": null, \\\"visual_quality_rating\\\": 4, \\\"artifact_presence_rating\\\": 2, \\\"detected_artifacts\\\": [\\\"image truncation\\\"], \\\"confidence\\\": 0.8, \\\"rationale\\\": \\\"The MRI image of the knee joint appears to be of good visual quality, with clear delineation of the anatomical structures. However, there is a minor artifact due to image truncation at the top edge. The overall quality is not significantly compromised.\\\"}\"\n      }\n    }\n  },\n  {\n    \"image_path\": \"analysis_history\\\\images\\\\20251002_190619\\\\image_003.webp\",\n    \"image_name\": \"image_003.webp\",\n    \"model_results\": {\n      \"GPT-5 Vision\": {\n        \"model_name\": \"GPT-5 Vision (gpt-5-nano)\",\n        \"movement_rating\": None,\n        \"visual_quality_rating\": 3.0,\n        \"artifact_presence_rating\": 2.0,\n        \"detected_artifacts\": [],\n        \"confidence\": 0.45,\n        \"rationale\": \"Two chest radiographs (PA-like and AP-like) with identifiable anatomy: lungs, heart, mediastinum, diaphragms, clavicles, ribs, and scapulae. No acute cardiopulmonary abnormality detected: no focal consolidation, pleural effusion, or pneumothorax observed on either view. Cardiomediastinal silhouette within normal size for projection. Mild basilar atelectasis or scar suspected, more conspicuous on the left (PA-like) view, possibly related to shallow inspiration. In the AP-like view the scapulae overlapped the lung fields as expected for that projection. Overall image quality is moderate with some projection-related limitations and mild overlap in one view, which limits subtle finding detection.\",\n        \"raw_response\": \"{\\n  \\\"movement_rating\\\": null,\\n  \\\"visual_quality_rating\\\": 3,\\n  \\\"artifact_presence_rating\\\": 2,\\n  \\\"detected_artifacts\\\": [],\\n  \\\"confidence\\\": 0.45,\\n  \\\"rationale\\\": \\\"Two chest radiographs (PA-like and AP-like) with identifiable anatomy: lungs, heart, mediastinum, diaphragms, clavicles, ribs, and scapulae. No acute cardiopulmonary abnormality detected: no focal consolidation, pleural effusion, or pneumothorax observed on either view. Cardiomediastinal silhouette within normal size for projection. Mild basilar atelectasis or scar suspected, more conspicuous on the left (PA-like) view, possibly related to shallow inspiration. In the AP-like view the scapulae overlapped the lung fields as expected for that projection. Overall image quality is moderate with some projection-related limitations and mild overlap in one view, which limits subtle finding detection.\\\"\\n}\"\n      },\n      \"Gemini 2.5 Vision\": {\n        \"model_name\": \"Gemini 2.5 Vision (gemini-2.5-flash-lite)\",\n        \"movement_rating\": None,\n        \"visual_quality_rating\": 3.0,\n        \"artifact_presence_rating\": 2.0,\n        \"detected_artifacts\": [\n          \"slight underexposure\"\n        ],\n        \"confidence\": 0.9,\n        \"rationale\": \"The image is a chest X-ray with both PA and AP views. The PA view shows the scapulae out of the lung fields, clavicles projecting onto the lung field, and posterior ribs distinct, consistent with a PA projection. The AP view shows the scapulae overlapping the lung fields, clavicles above the apices of the lung, and anterior ribs distinct, consistent with an AP projection. The image quality is fair, with some underexposure, making it difficult to fully assess finer details of the lung parenchyma. No significant abnormalities or anomalies are readily apparent in the visualized structures. The comparison table accurately describes the expected findings for each view.\",\n        \"raw_response\": \"```json\\n{\\n  \\\"movement_rating\\\": null,\\n  \\\"visual_quality_rating\\\": 3,\\n  \\\"artifact_presence_rating\\\": 2,\\n  \\\"detected_artifacts\\\": [\\n    \\\"slight underexposure\\\"\\n  ],\\n  \\\"confidence\\\": 0.9,\\n  \\\"rationale\\\": \\\"The image is a chest X-ray with both PA and AP views. The PA view shows the scapulae out of the lung fields, clavicles projecting onto the lung field, and posterior ribs distinct, consistent with a PA projection. The AP view shows the scapulae overlapping the lung fields, clavicles above the apices of the lung, and anterior ribs distinct, consistent with an AP projection. The image quality is fair, with some underexposure, making it difficult to fully assess finer details of the lung parenchyma. No significant abnormalities or anomalies are readily apparent in the visualized structures. The comparison table accurately describes the expected findings for each view.\\\"\\n}\\n```\"\n      },\n      \"Llama 3.2 Vision\": {\n        \"model_name\": \"Llama 3.2 Vision (meta-llama/llama-3.2-90b-vision-instruct)\",\n        \"movement_rating\": None,\n        \"visual_quality_rating\": 4.0,\n        \"artifact_presence_rating\": 2.0,\n        \"detected_artifacts\": [\n          \"Scapula overlapping lung fields\",\n          \"Clavicles not ideally positioned\"\n        ],\n        \"confidence\": 0.8,\n        \"rationale\": \"The image presents two chest X-ray views (PA and AP) with annotations highlighting differences in technique and quality. The PA view is generally considered of higher quality due to better positioning (e.g., scapula not overlapping lung fields). The AP view shows some artifacts and less ideal positioning (e.g., scapula overlapping lung fields, clavicles above apices). Overall, the visual quality is good, but there are noticeable differences in artifact presence between the two views.\",\n        \"raw_response\": \"{\\n  \\\"movement_rating\\\": null,\\n  \\\"visual_quality_rating\\\": 4, \\\"artifact_presence_rating\\\": 2,\\n  \\\"detected_artifacts\\\": [\\\"Scapula overlapping lung fields\\\", \\\"Clavicles not ideally positioned\\\"],\\n  \\\"confidence\\\": 0.8,\\n  \\\"rationale\\\": \\\"The image presents two chest X-ray views (PA and AP) with annotations highlighting differences in technique and quality. The PA view is generally considered of higher quality due to better positioning (e.g., scapula not overlapping lung fields). The AP view shows some artifacts and less ideal positioning (e.g., scapula overlapping lung fields, clavicles above apices). Overall, the visual quality is good, but there are noticeable differences in artifact presence between the two views.\\\"\\n}\"\n      }\n    }\n  },\n  {\n    \"image_path\": \"analysis_history\\\\images\\\\20251002_190619\\\\image_004.webp\",\n    \"image_name\": \"image_004.webp\",\n    \"model_results\": {\n      \"GPT-5 Vision\": {\n        \"model_name\": \"GPT-5 Vision (gpt-5-nano)\",\n        \"movement_rating\": None,\n        \"visual_quality_rating\": 2.0,\n        \"artifact_presence_rating\": 3.0,\n        \"detected_artifacts\": [\n          \"motion artifact\",\n          \"low resolution\",\n          \"low contrast\"\n        ],\n        \"confidence\": 0.42,\n        \"rationale\": \"The image appears to be a single frame from a dynamic knee imaging context, with the accompanying slide text suggesting patellar tracking. However, the frame is low in resolution and shows blur/noise, limiting clear visualization of joint structures. Movement assessment cannot be reliably performed from a single frame. Artifacts such as motion and reduced contrast degrade image quality, preventing definitive identification of anatomical structures or abnormalities. Possible knee joint elements (femur, tibia, patella) may be present but are not clearly discernible in this image.\",\n        \"raw_response\": \"{\\n  \\\"movement_rating\\\": null,\\n  \\\"visual_quality_rating\\\": 2,\\n  \\\"artifact_presence_rating\\\": 3,\\n  \\\"detected_artifacts\\\": [\\\"motion artifact\\\", \\\"low resolution\\\", \\\"low contrast\\\"],\\n  \\\"confidence\\\": 0.42,\\n  \\\"rationale\\\": \\\"The image appears to be a single frame from a dynamic knee imaging context, with the accompanying slide text suggesting patellar tracking. However, the frame is low in resolution and shows blur/noise, limiting clear visualization of joint structures. Movement assessment cannot be reliably performed from a single frame. Artifacts such as motion and reduced contrast degrade image quality, preventing definitive identification of anatomical structures or abnormalities. Possible knee joint elements (femur, tibia, patella) may be present but are not clearly discernible in this image.\\\"\\n}\"\n      },\n      \"Gemini 2.5 Vision\": {\n        \"model_name\": \"Gemini 2.5 Vision (gemini-2.5-flash-lite)\",\n        \"movement_rating\": None,\n        \"visual_quality_rating\": 3.0,\n        \"artifact_presence_rating\": 3.0,\n        \"detected_artifacts\": [\n          \"motion artifact\"\n        ],\n        \"confidence\": 0.7,\n        \"rationale\": \"The image quality is moderate, with some blurring and signal loss consistent with motion artifact, as indicated by the \\\"Dynamic Imaging\\\" title and the visual appearance of the structures. The anatomical structures of the knee, including the femur, tibia, patella, and surrounding soft tissues, are generally discernible but not sharply defined. There are no obvious gross abnormalities or anomalies visible, but the motion artifact limits the diagnostic confidence in assessing fine details. A rating of 3 for visual quality and artifact presence reflects this moderate image quality and the presence of noticeable, albeit common in dynamic imaging, artifacts.\",\n        \"raw_response\": \"```json\\n{\\n  \\\"movement_rating\\\": null,\\n  \\\"visual_quality_rating\\\": 3,\\n  \\\"artifact_presence_rating\\\": 3,\\n  \\\"detected_artifacts\\\": [\\n    \\\"motion artifact\\\"\\n  ],\\n  \\\"confidence\\\": 0.7,\\n  \\\"rationale\\\": \\\"The image quality is moderate, with some blurring and signal loss consistent with motion artifact, as indicated by the \\\\\\\"Dynamic Imaging\\\\\\\" title and the visual appearance of the structures. The anatomical structures of the knee, including the femur, tibia, patella, and surrounding soft tissues, are generally discernible but not sharply defined. There are no obvious gross abnormalities or anomalies visible, but the motion artifact limits the diagnostic confidence in assessing fine details. A rating of 3 for visual quality and artifact presence reflects this moderate image quality and the presence of noticeable, albeit common in dynamic imaging, artifacts.\\\"\\n}\\n```\"\n      },\n      \"Llama 3.2 Vision\": {\n        \"model_name\": \"Llama 3.2 Vision (meta-llama/llama-3.2-90b-vision-instruct)\",\n        \"movement_rating\": None,\n        \"visual_quality_rating\": 4.0,\n        \"artifact_presence_rating\": 2.0,\n        \"detected_artifacts\": [\n          \"Motion artifacts are not evident, but some noise is present\"\n        ],\n        \"confidence\": 0.8,\n        \"rationale\": \"The image appears to be an MRI scan of a knee joint, and the quality is generally good. The text on the left describes dynamic imaging, which is useful for visualizing patellar tracking. The image on the right shows a clear view of the knee joint, but some noise is visible.\",\n        \"raw_response\": \"```json\\n{\\n  \\\"movement_rating\\\": null,\\n  \\\"visual_quality_rating\\\": 4,\\n  \\\"artifact_presence_rating\\\": 2,\\n  \\\"detected_artifacts\\\": [\\\"Motion artifacts are not evident, but some noise is present\\\"],\\n  \\\"confidence\\\": 0.8,\\n  \\\"rationale\\\": \\\"The image appears to be an MRI scan of a knee joint, and the quality is generally good. The text on the left describes dynamic imaging, which is useful for visualizing patellar tracking. The image on the right shows a clear view of the knee joint, but some noise is visible.\\\"\\n}\\n```\"\n      }\n    }\n  }\n]\n\n# Prepare the data into a DataFrame\nrecords = []\nfor item in data:\n    image_id = item['image_name']\n    for model_name, model_output in item['model_results'].items():\n        record = {\n            'image_id': image_id,\n            'model_id': model_name,\n            'movement_rating': model_output.get('movement_rating'),\n            'visual_quality_rating': model_output.get('visual_quality_rating'),\n            'artifact_presence_rating': model_output.get('artifact_presence_rating'),\n            'confidence': model_output.get('confidence')\n        }\n        records.append(record)\n\ndf = pd.DataFrame(records)\n\n# Ensure types\ndf['image_id'] = df['image_id'].astype(str)\nif 'model_id' in df.columns:\n    df['model_id'] = df['model_id'].astype(str)\nelse:\n    df['model_id'] = df['model'].astype(str) if 'model' in df.columns else df.index.astype(str)\n\n# Utility to compute agreement for a given label column\ndef compute_agreement(df, label_col):\n    # group by image and compute majority label and agreement rate\n    def _image_stats(g):\n        total = len(g)\n        counts = g[label_col].value_counts(dropna=True)\n        if counts.empty:\n            majority_label = np.nan\n            agreement_rate = 0.0\n        else:\n            majority_label = counts.idxmax()\n            agreement_rate = counts.max() / total\n        mean_conf = g['confidence'].mean() if 'confidence' in g else np.nan\n        std_conf = g['confidence'].std(ddof=0) if 'confidence' in g else np.nan\n        return pd.Series({\n            'n_models': total,\n            'majority_label': majority_label,\n            'agreement_rate': agreement_rate,\n            'mean_confidence': mean_conf,\n            'std_confidence': std_conf\n        })\n\n    image_stats = df.groupby('image_id').apply(_image_stats).reset_index()\n\n    # Per-structure (label) summary: how often a label is majority and its average agreement\n    label_summary = (\n        image_stats.groupby('majority_label')\n        .agg(images_as_majority=('image_id', 'count'),\n             avg_agreement=('agreement_rate', 'mean'))\n        .sort_values('images_as_majority', ascending=False)\n        .reset_index()\n    )\n\n    # Pairwise model agreement matrix (proportion of identical labels between models)\n    models = df['model_id'].unique()\n    pairwise = pd.DataFrame(index=models, columns=models, dtype=float)\n\n    # Build pivot table: rows image_id, cols model_id, values = label\n    pivot = df.pivot_table(index='image_id', columns='model_id', values=label_col, aggfunc=lambda x: x.iloc[0])\n\n    for m1 in models:\n        for m2 in models:\n            # compute fraction of images where both models provided a label and labels match\n            col1 = pivot.get(m1)\n            col2 = pivot.get(m2)\n            valid = col1.notna() & col2.notna()\n            if valid.sum() == 0:\n                pairwise.loc[m1, m2] = np.nan\n            else:\n                pairwise.loc[m1, m2] = (col1[valid] == col2[valid]).mean()\n\n    return {\n        'image_stats': image_stats,\n        'label_summary': label_summary,\n        'pairwise_agreement': pairwise,\n        'pivot': pivot\n    }\n\n# Compute for relevant rating columns\nresults = {}\nrating_columns = ['movement_rating', 'visual_quality_rating', 'artifact_presence_rating']\n\nfor col in rating_columns:\n    if col in df.columns:\n        # Filter out rows where the rating is None/NaN before computing agreement for that specific column\n        df_filtered = df.dropna(subset=[col]).copy()\n        if not df_filtered.empty:\n            results[col] = compute_agreement(df_filtered, col)\n        else:\n            print(f\"Skipping agreement computation for '{col}' as no valid ratings were found.\")\n\n\n# Additional analyses: correlation between mean_confidence and agreement_rate\nfor key in list(results.keys()):\n    image_stats = results[key]['image_stats']\n    # handle NaNs\n    corr = image_stats[['agreement_rate', 'mean_confidence']].dropna()\n    if not corr.empty:\n        results[key]['confidence_agreement_correlation'] = corr['agreement_rate'].corr(corr['mean_confidence'])\n    else:\n        results[key]['confidence_agreement_correlation'] = np.nan\n\n    # Flag images with low agreement or low confidence\n    LOW_AGREEMENT_THRESHOLD = 0.6\n    LOW_CONFIDENCE_THRESHOLD = 0.5\n    flags = image_stats[(image_stats['agreement_rate'] < LOW_AGREEMENT_THRESHOLD) |\n                        (image_stats['mean_confidence'] < LOW_CONFIDENCE_THRESHOLD)]\n    results[key]['flags'] = flags.sort_values(['agreement_rate', 'mean_confidence'])\n\n# Summary metrics per model: average confidence and average agreement with majority\nif results: # Check if there are any results to process\n    for label_type in results.keys():\n        pivot = results[label_type]['pivot']\n        # For each model, compute average confidence and agreement with image majority\n        model_stats = []\n        image_stats = results[label_type]['image_stats'].set_index('image_id')\n        for m in pivot.columns:\n            # average confidence from original df (before dropping NAs for specific columns)\n            conf = df[df['model_id'] == m]['confidence'].mean()\n            # agreement with majority: for images where model provided label, compare to majority_label\n            provided_labels = pivot[m].dropna()\n            if provided_labels.empty:\n                agreement_with_majority = np.nan\n            else:\n                # Need to ensure 'image_stats' for the current label_type contains the images for which 'provided_labels' exist.\n                # If an image had no valid ratings for a particular `label_type`, it won't be in `image_stats` for that `label_type`.\n                # So we need to filter `maj` to only include indices present in `image_stats`.\n                valid_indices = provided_labels.index.intersection(image_stats.index)\n                if not valid_indices.empty:\n                    maj = image_stats.loc[valid_indices, 'majority_label']\n                    agreement_with_majority = (provided_labels.loc[valid_indices] == maj).mean()\n                else:\n                    agreement_with_majority = np.nan\n            model_stats.append({'model_id': m, 'mean_confidence': conf, 'agreement_with_majority': agreement_with_majority})\n        results[label_type]['model_stats'] = pd.DataFrame(model_stats).set_index('model_id')\n\n# Print results\nfor rating_type, res in results.items():\n    print(f\"\\n--- Analysis for: {rating_type.replace('_', ' ').title()} ---\")\n    \n    print(\"\\nImage Statistics (first 5 rows):\")\n    print(res['image_stats'].head().to_markdown(index=False, numalign=\"left\", stralign=\"left\"))\n\n    print(\"\\nLabel Summary:\")\n    print(res['label_summary'].to_markdown(index=False, numalign=\"left\", stralign=\"left\"))\n\n    print(\"\\nPairwise Model Agreement:\")\n    print(res['pairwise_agreement'].to_markdown(numalign=\"left\", stralign=\"left\"))\n\n    print(\"\\nConfidence-Agreement Correlation:\")\n    print(res['confidence_agreement_correlation'])\n\n    print(\"\\nFlagged Images (Low Agreement or Low Confidence):\")\n    if not res['flags'].empty:\n        print(res['flags'].to_markdown(index=False, numalign=\"left\", stralign=\"left\"))\n    else:\n        print(\"None\")\n\n    print(\"\\nModel Statistics:\")\n    print(res['model_stats'].to_markdown(numalign=\"left\", stralign=\"left\"))\n\n",
    "execution_method": "gemini_code_execution"
  }
}